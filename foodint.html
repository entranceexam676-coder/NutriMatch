<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NutriMatch | Food Intelligence</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
  <style>
    :root {
      --primary: #2E7D32;
      --secondary: #4CAF50;
      --light-bg: #F8FAF9;
      --text-dark: #222;
      --text-light: #fff;
      --radius: 12px;
    }
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
    body{background:var(--light-bg);color:var(--text-dark);}
    nav{background:var(--primary);color:white;display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem;}
    nav h1{font-size:1.5rem;}
    nav ul{display:flex;gap:1.2rem;list-style:none;}
    nav a{color:white;text-decoration:none;font-weight:500;}
    nav a:hover{color:#b3efb5;}
    .container{max-width:900px;margin:2rem auto;background:white;border-radius:var(--radius);box-shadow:0 4px 10px rgba(0,0,0,0.1);padding:2rem;}
    h2{text-align:center;color:var(--primary);margin-bottom:1rem;}
    .options{display:flex;justify-content:center;gap:1rem;margin-bottom:1rem;flex-wrap:wrap;}
    button,label{background:var(--secondary);color:white;border:none;padding:.8rem 1.2rem;border-radius:var(--radius);cursor:pointer;transition:.3s;font-weight:500;}
    button:hover,label:hover{background:var(--primary);}
    input[type=file]{display:none;}
    .search-area{text-align:center;margin:1.5rem 0;}
    input[type=text]{padding:.8rem;width:60%;border-radius:var(--radius);border:1px solid #ccc;}
    video,canvas{display:block;margin:1rem auto;border-radius:var(--radius);box-shadow:0 2px 8px rgba(0,0,0,0.15);}
    video{width:320px;height:240px;background:black;}
    .result-card{background:#f1f8f4;border-left:6px solid var(--secondary);border-radius:var(--radius);padding:1.5rem;margin-top:1rem;}
    .result-card h3{color:var(--primary);}
    table{width:100%;border-collapse:collapse;margin-top:.5rem;}
    td,th{padding:.6rem;text-align:left;border-bottom:1px solid #ddd;}
    th{color:var(--primary);}
    footer{text-align:center;padding:1rem;background:var(--primary);color:white;margin-top:2rem;border-top-left-radius:10px;border-top-right-radius:10px;}
  </style>
</head>
<body>
  <nav>
    <h1>NutriMatch</h1>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="ai.html">AI Nutrition</a></li>
      <li><a href="foodint.html">Food Intelligence</a></li>
      <li><a href="healtthtrack.html">Health</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>

  <div class="container">
    <h2>AI-Powered Food Intelligence</h2>
    <div class="options">
      <button id="startCamera">üì∑ Start Scan</button>
      <label for="fileInput">üìÅ Upload Image</label>
      <input type="file" id="fileInput" accept="image/*" />
    </div>

    <div class="search-area">
      <input type="text" id="searchInput" placeholder="Enter food name (e.g., apple, rice)">
      <button id="searchBtn">Search</button>
    </div>

    <video id="video" autoplay muted playsinline></video>
    <canvas id="canvas" hidden></canvas>

    <div id="result"></div>
  </div>

  <footer>¬© 2025 NutriMatch ‚Äî AI Powered Nutrition & Food Intelligence</footer>

  <script>
    const startCameraBtn = document.getElementById("startCamera");
    const fileInput = document.getElementById("fileInput");
    const searchBtn = document.getElementById("searchBtn");
    const searchInput = document.getElementById("searchInput");
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const resultDiv = document.getElementById("result");
    let stream = null;

    
    startCameraBtn.onclick = async () => {
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        video.srcObject = stream;
        scanCamera();
      } catch (err) {
        alert("Camera not available.");
      }
    };

    function scanCamera() {
      if (video.readyState === video.HAVE_ENOUGH_DATA) {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const code = jsQR(imageData.data, imageData.width, imageData.height);
        if (code) {
          stopCamera();
          lookupFood(code.data);
          return;
        }
      }
      requestAnimationFrame(scanCamera);
    }

    function stopCamera() {
      if (stream) stream.getTracks().forEach((t) => t.stop());
    }


    fileInput.onchange = (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const img = new Image();
      img.onload = () => {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const code = jsQR(imageData.data, imageData.width, imageData.height);
        if (code) {
          lookupFood(code.data);
        } else {
          alert("No barcode detected.");
        }
      };
      img.src = URL.createObjectURL(file);
    };

 
    searchBtn.onclick = () => {
      const query = searchInput.value.trim();
      if (query) searchByName(query);
    };

    
    async function lookupFood(code) {
      const res = await fetch(`https://world.openfoodfacts.org/api/v0/product/${code}.json`);
      const data = await res.json();
      if (data.status === 1) showFood(data.product);
      else resultDiv.innerHTML = `<p>No data found for code: ${code}</p>`;
    }

    
    async function searchByName(query) {
      const res = await fetch(`https://world.openfoodfacts.org/cgi/search.pl?search_terms=${query}&search_simple=1&action=process&json=1`);
      const data = await res.json();
      if (data.products && data.products.length) showFood(data.products[0]);
      else resultDiv.innerHTML = `<p>No results found for "${query}"</p>`;
    }


    function showFood(food) {
      const n = food.nutriments || {};
      resultDiv.innerHTML = `
        <div class="result-card">
          <h3>${food.product_name || "Unknown Food"}</h3>
          <table>
            <tr><th>Nutrient</th><th>Per 100g</th></tr>
            <tr><td>Calories</td><td>${n["energy-kcal_100g"] || "‚Äî"}</td></tr>
            <tr><td>Fat</td><td>${n.fat_100g || "‚Äî"} g</td></tr>
            <tr><td>Carbs</td><td>${n.carbohydrates_100g || "‚Äî"} g</td></tr>
            <tr><td>Protein</td><td>${n.proteins_100g || "‚Äî"} g</td></tr>
            <tr><td>Sugar</td><td>${n.sugars_100g || "‚Äî"} g</td></tr>
            <tr><td>Salt</td><td>${n.salt_100g || "‚Äî"} g</td></tr>
          </table>
        </div>
      `;
    }
  </script>
</body>
</html>
